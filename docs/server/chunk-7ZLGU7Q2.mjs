import './polyfills.server.mjs';
import{A as B,B as J,C as c,D as K,E as T,F as u,K as Q,M as U,O as S,P as q,R as Z,S as k,T as X,U as Y,X as ee,a as h,b as _,ba as te,c as f,d as p,e as E,f as D,g as G,h as O,i as m,j as C,k as a,l as N,m as v,n as M,o as W,p as P,q as j,r as F,s as l,t as s,u as R,v as A,w as V,x as H,y as L,z}from"./chunk-4JZIM2VO.mjs";var pe=[[["grid-cell"]]],me=["grid-cell"],y=class n{static \u0275fac=function(r){return new(r||n)};static \u0275cmp=p({type:n,selectors:[["grid-container"]],standalone:!0,features:[u],ngContentSelectors:me,decls:1,vars:0,template:function(r,o){r&1&&(H(pe),L(0))},styles:["[_nghost-%COMP%]{background:#aa8b6d;padding:2px;width:416px;display:flex;flex-wrap:wrap}"]})};function ue(n,e){if(n&1&&(l(0,"p",1),c(1),s()),n&2){let r=V();m(),K(r._cellState.value)}}var d=class n{_cellState={key:0,value:0};cellState=a(null);bcg$$=a("#ffa500");cellColor$$=a("#808080");cellFontSize$$=a("50px");constructor(){S(()=>{this.stateEmitter.emit(this.cellState())})}ngOnChanges(e){}stateEmitter=new D;set value(e){this._cellState.value=e;let r=e<100?"50px":"40px";this.cellFontSize$$.set(r)}get val(){return this._cellState.value}set key(e){this._cellState.key=e}set _isNew(e){this._cellState.new=e;let r=e?"#97ba1e":"#808080";this.bcg$$.set(r),this.cellColor$$.set("#ffffff")}get hasValue(){return!!this.val}static \u0275fac=function(r){return new(r||n)};static \u0275cmp=p({type:n,selectors:[["grid-cell"]],hostVars:8,hostBindings:function(r,o){r&2&&(M("--cell-bcg",o.bcg$$())("--cell-color",o.cellColor$$())("--cell-font-size",o.cellFontSize$$()),W("has-value",o.hasValue))},inputs:{value:"value",key:[0,"cellKey","key"],_isNew:[0,"cellNew","_isNew"]},outputs:{stateEmitter:"gridCellEmitter"},standalone:!0,features:[E,u],decls:1,vars:1,consts:[["class","value",4,"ngIf"],[1,"value"]],template:function(r,o){r&1&&N(0,ue,2,1,"p",0),r&2&&v("ngIf",o.hasValue)},dependencies:[Z],styles:["[_nghost-%COMP%]{display:flex;width:100px;height:100px;background:#eee4da59;margin:2px;align-items:center;justify-content:center;background-color:var(--cell-bcg);color:var(--cell-color);transition:.5s}.value[_ngcontent-%COMP%]{font-size:var(--cell-font-size);margin:0}"]})};var $=(i=>(i.right="ArrowRight",i.left="ArrowLeft",i.up="ArrowUp",i.down="ArrowDown",i))($||{});function oe(n){return Object.values($).includes(n)}var ne=new _("WindowToken",{factory:()=>{let n=f(G);return k(n)?window:new Window}}),Ve=new _("DocumentToken",{factory:()=>{let n=f(G);return k(n)?document:new Document}});var b=class n{_window=f(ne);saveState(e){e.length&&(this.clear(),this._window.localStorage?.setItem("state",JSON.stringify(e)))}getState(){let e=this._window.localStorage?.getItem("state");return e?JSON.parse(e):[]}clear(){this.getState()&&this._window.localStorage?.clear()}saveTurn(e){this._window.localStorage?.setItem("turn",JSON.stringify(e))}getTurn(){let e=this._window.localStorage?.getItem("turn");return e?JSON.parse(e):1}saveScore(e){this._window.localStorage?.setItem("score",JSON.stringify(e))}getScore(){let e=this._window.localStorage?.getItem("score");return console.log(e),e?JSON.parse(e):0}static \u0275fac=function(r){return new(r||n)};static \u0275prov=h({token:n,factory:n.\u0275fac,providedIn:"root"})};var I=class n{getRandomArrayEl(e){let r=Math.floor(Math.random()*e.length);return e[r]}splitArray(e,r){let o=[[],[],[],[]];return e.forEach(i=>{let t=r==="ArrowRight"||r==="ArrowLeft"?Math.floor((i.key??0)/4):Math.floor((i.key??0)%4);o[t].push(i)}),o}shiftArray(e,r){let o=e.length,i=0;if(r==="ArrowRight"||r==="ArrowDown"){for(let t=0;t<o-1;t++)(e[t].value&&!e[t+1].value||e[t].value===e[t+1].value)&&(i+=this.mergeCells(e[t+1],e[t]),e[t+1].value+=e[t].value,e[t].value=0);for(let t=0;t<o-1;t++)e[t].value&&!e[t+1].value&&(e[t+1].value=e[t].value,e[t].value=0);for(let t=0;t<o-1;t++)e[t].value&&!e[t+1].value&&(e[t+1].value=e[t].value,e[t].value=0)}else if(r==="ArrowUp"||r==="ArrowLeft"){for(let t=o-1;t>0;t--)(e[t].value&&!e[t-1].value||e[t].value===e[t-1].value)&&(i+=this.mergeCells(e[t-1],e[t]),e[t-1].value+=e[t].value,e[t].value=0);for(let t=e.length-1;t>0;t--)e[t].value&&!e[t-1].value&&(e[t-1].value=e[t].value,e[t].value=0);for(let t=e.length-1;t>0;t--)e[t].value&&!e[t-1].value&&(e[t-1].value=e[t].value,e[t].value=0)}return[e,i]}mergeCells(e,r){return e.value===0||r.value===0||e.value!==r.value?0:e.value+r.value}static \u0275fac=function(r){return new(r||n)};static \u0275prov=h({token:n,factory:n.\u0275fac,providedIn:"root"})};function ge(n,e){if(n&1&&R(0,"grid-cell",3),n&2){let r=e.$implicit;v("cellKey",r.key)("cellValue",r.value)("cellNew",r.new)}}var x=class n{constructor(e,r,o){this.cdr=e;this.ls=r;this.shift=o;S(()=>{if(!this.cellList.length)return;let i=this.state$$();this.ls.saveState(i);for(let t of i)this.cellList.forEach(g=>{g._cellState.key===t.key&&(g._cellState.value=t.value,g._cellState.new=t.new)});this.ls.saveTurn(this.turn$$()),this.ls.saveScore(this.score$$()),setTimeout(()=>(this.cdr.detectChanges(),this.hasEmptyCells(this.cellList).length?null:alert("GAME OVER!!")),0)})}state$$=a([]);turn$$=a(1);score$$=a(0);cellList=[];ngAfterViewInit(){this.startGame()}move(e){let r=e.code;oe(r)&&(this.toggleCellsOld(),this.state$$.update(o=>(this.shift.splitArray(o,r).forEach(t=>{let[g,se]=this.shift.shiftArray(t,r);this.score$$.update(ce=>ce+se)}),o)),this.turn$$.update(o=>o+=1),this.generateValues())}generateKeys(e=4,r=4){let o=[];for(let i=0;i<e*r;i++)o.push({key:i,value:0,new:!1});this.state$$.set(o)}generateValues(e=1){for(;e>0;){let r=this.state$$(),o=this.getEmptyCells(r);if(!o.length)return;let i=this.shift.getRandomArrayEl(o);r.forEach(t=>{t.key===i.key&&(t.value=2,t.new=!0)}),e--,this.state$$.update(()=>[...r])}}getEmptyCells(e){return e.filter(r=>!r.value)}hasEmptyCells(e){return e.filter(r=>!r._cellState.value)}toggleCellsOld(){this.state$$.update(e=>(e.forEach(r=>r.new=!1),[...e]))}startGame(){let e=this.ls.getState();this.state$$.set(this.ls.getState()),this.turn$$.set(this.ls.getTurn()),this.score$$.set(this.ls.getScore()),e.length||(this.generateKeys(),this.generateValues(2),this.turn$$.set(1),this.score$$.set(0))}restartGame(){confirm("Are you sure you want to start a new game? All progress will be lost")&&(this.ls.clear(),this.startGame())}static \u0275fac=function(r){return new(r||n)(C(U),C(b),C(I))};static \u0275cmp=p({type:n,selectors:[["app-root"]],viewQuery:function(r,o){if(r&1&&z(d,5),r&2){let i;B(i=J())&&(o.cellList=i)}},hostBindings:function(r,o){r&1&&A("keydown",function(t){return o.move(t)},!1,O)},standalone:!0,features:[u],decls:12,vars:2,consts:[[1,"scoreboard"],[3,"click"],[1,"game"],[3,"cellKey","cellValue","cellNew"],[1,"rules"]],template:function(r,o){r&1&&(l(0,"div",0)(1,"h1"),c(2),s(),l(3,"h1"),c(4),s(),l(5,"button",1),A("click",function(){return o.restartGame()}),c(6,"New game"),s()(),l(7,"grid-container",2),j(8,ge,1,3,"grid-cell",3,P),s(),l(10,"div",4),c(11,` How to play: Use your arrow keys to move the tiles. Tiles with the same number merge into one when they touch. Add them up to reach 512!
`),s()),r&2&&(m(2),T("Turn: ",o.turn$$(),""),m(2),T("Score: ",o.score$$(),""),m(4),F(o.state$$()))},dependencies:[y,d],styles:["[_nghost-%COMP%]{display:flex;justify-content:flex-start;align-items:center;height:90svh;flex-direction:column}.scoreboard[_ngcontent-%COMP%]{margin-top:100px;display:flex;gap:1rem;color:gray;align-items:center}button[_ngcontent-%COMP%]{font-size:large;font-weight:600;color:gray;padding:5px;height:fit-content}button[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover{color:#97ba1e}.rules[_ngcontent-%COMP%]{margin-top:50px;width:420px;color:gray;font-size:larger}"]})};var ie=[{path:"**",redirectTo:""}];var ae={providers:[Q({eventCoalescing:!0}),te(ie),Y()]};var he={providers:[ee()]},le=q(ae,he);var Ce=()=>X(x,le),yt=Ce;export{yt as a};
