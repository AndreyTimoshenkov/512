import './polyfills.server.mjs';
import{A as B,B as K,C as m,D as Q,E as J,F as u,K as U,M as q,O as S,P as Z,R as X,S as T,T as Y,U as ee,X as te,a as p,b as _,ba as re,c as l,d as f,e as D,f as E,g as A,h as O,i as d,j as h,k as a,l as N,m as v,n as M,o as j,p as W,q as F,r as P,s,t as c,u as R,v as k,w as V,x as H,y as L,z}from"./chunk-4JZIM2VO.mjs";var ce=[[["grid-cell"]]],pe=["grid-cell"],y=class n{static \u0275fac=function(r){return new(r||n)};static \u0275cmp=f({type:n,selectors:[["grid-container"]],standalone:!0,features:[u],ngContentSelectors:pe,decls:1,vars:0,template:function(r,o){r&1&&(H(ce),L(0))},styles:["[_nghost-%COMP%]{background:#aa8b6d;padding:2px;width:416px;display:flex;flex-wrap:wrap}"]})};function fe(n,e){if(n&1&&(s(0,"p",1),m(1),c()),n&2){let r=V();d(),Q(r._cellState.value)}}var C=class n{_cellState={key:0,value:0};cellState=a(null);bcg$$=a("#ffa500");cellColor$$=a("#808080");cellFontSize$$=a("50px");constructor(){S(()=>{this.stateEmitter.emit(this.cellState())})}ngOnChanges(e){}stateEmitter=new E;set value(e){this._cellState.value=e;let r=e<100?"50px":"40px";this.cellFontSize$$.set(r)}get val(){return this._cellState.value}set key(e){this._cellState.key=e}set _isNew(e){this._cellState.new=e;let r=e?"#97ba1e":"#808080";this.bcg$$.set(r),this.cellColor$$.set("#ffffff")}get hasValue(){return!!this.val}static \u0275fac=function(r){return new(r||n)};static \u0275cmp=f({type:n,selectors:[["grid-cell"]],hostVars:8,hostBindings:function(r,o){r&2&&(M("--cell-bcg",o.bcg$$())("--cell-color",o.cellColor$$())("--cell-font-size",o.cellFontSize$$()),j("has-value",o.hasValue))},inputs:{value:"value",key:[0,"cellKey","key"],_isNew:[0,"cellNew","_isNew"]},outputs:{stateEmitter:"gridCellEmitter"},standalone:!0,features:[D,u],decls:1,vars:1,consts:[["class","value",4,"ngIf"],[1,"value"]],template:function(r,o){r&1&&N(0,fe,2,1,"p",0),r&2&&v("ngIf",o.hasValue)},dependencies:[X],styles:["[_nghost-%COMP%]{display:flex;width:100px;height:100px;background:#eee4da59;margin:2px;align-items:center;justify-content:center;background-color:var(--cell-bcg);color:var(--cell-color);transition:.5s}.value[_ngcontent-%COMP%]{font-size:var(--cell-font-size);margin:0}"]})};var w=(t=>(t.right="ArrowRight",t.left="ArrowLeft",t.up="ArrowUp",t.down="ArrowDown",t))(w||{});function ne(n){return Object.values(w).includes(n)}var ie=new _("WindowToken",{factory:()=>{let n=l(A);return T(n)?window:new Window}}),Re=new _("DocumentToken",{factory:()=>{let n=l(A);return T(n)?document:new Document}});var b=class n{_window=l(ie);saveState(e){e.length&&(this.clear(),this._window.localStorage?.setItem("state",JSON.stringify(e)))}getState(){let e=this._window.localStorage?.getItem("state");return e?JSON.parse(e):[]}clear(){this.getState()&&this._window.localStorage?.clear()}saveTurn(e){this._window.localStorage?.setItem("turn",JSON.stringify(e))}getTurn(){let e=this._window.localStorage?.getItem("turn");return e?JSON.parse(e):1}static \u0275fac=function(r){return new(r||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};var I=class n{score$$=a(0);mergeCells(e,r){if(Math.abs(e.key-r.key)!==1||e.value!==r.value)return;let o=e.value+r.value;this.score$$.update(t=>t+=o)}resetScore(){this.score$$.set(0)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};var $=class n{scoreService=l(I);getRandomArrayEl(e){let r=Math.floor(Math.random()*e.length);return e[r]}splitArray(e,r){let o=[[],[],[],[]];return e.forEach(t=>{let i=r==="ArrowRight"||r==="ArrowLeft"?Math.floor((t.key??0)/4):Math.floor((t.key??0)%4);o[i].push(t)}),o}shiftArray(e,r){let o=e.length;if(r==="ArrowRight"||r==="ArrowDown"){for(let t=0;t<o-1;t++)(e[t].value&&!e[t+1].value||e[t].value===e[t+1].value)&&(e[t+1].value+=e[t].value,this.scoreService.mergeCells(e[t+1],e[t]),e[t].value=0);for(let t=0;t<o-1;t++)e[t].value&&!e[t+1].value&&(e[t+1].value=e[t].value,e[t].value=0);for(let t=0;t<o-1;t++)e[t].value&&!e[t+1].value&&(e[t+1].value=e[t].value,e[t].value=0)}else if(r==="ArrowUp"||r==="ArrowLeft"){for(let t=o-1;t>0;t--)(e[t].value&&!e[t-1].value||e[t].value===e[t-1].value)&&(e[t-1].value+=e[t].value,this.scoreService.mergeCells(e[t-1],e[t]),e[t].value=0);for(let t=e.length-1;t>0;t--)e[t].value&&!e[t-1].value&&(e[t-1].value=e[t].value,e[t].value=0);for(let t=e.length-1;t>0;t--)e[t].value&&!e[t-1].value&&(e[t-1].value=e[t].value,e[t].value=0)}return e}static \u0275fac=function(r){return new(r||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};function de(n,e){if(n&1&&R(0,"grid-cell",2),n&2){let r=e.$implicit;v("cellKey",r.key)("cellValue",r.value)("cellNew",r.new)}}var G=class n{constructor(e,r,o){this.cdr=e;this.ls=r;this.shift=o;S(()=>{if(!this.cellList.length)return;let t=this.state$$();this.ls.saveState(t);for(let i of t)this.cellList.forEach(x=>{x._cellState.key===i.key&&(x._cellState.value=i.value,x._cellState.new=i.new)});this.ls.saveTurn(this.turn$$()),setTimeout(()=>(this.cdr.detectChanges(),this.hasEmptyCells(this.cellList).length?null:alert("GAME OVER!!")),0)})}state$$=a([]);turn$$=a(1);cellList=[];ngAfterViewInit(){this.startGame()}move(e){let r=e.code;ne(r)&&(this.toggleCellsOld(),this.state$$.update(o=>(this.shift.splitArray(o,r).forEach(i=>this.shift.shiftArray(i,r)),o)),this.turn$$.update(o=>o+=1),this.generateValues())}generateKeys(e=4,r=4){let o=[];for(let t=0;t<e*r;t++)o.push({key:t,value:0,new:!1});this.state$$.set(o)}generateValues(e=1){for(;e>0;){let r=this.state$$(),o=this.getEmptyCells(r);if(!o.length)return;let t=this.shift.getRandomArrayEl(o);r.forEach(i=>{i.key===t.key&&(i.value=2,i.new=!0)}),e--,this.state$$.update(()=>[...r])}}getEmptyCells(e){return e.filter(r=>!r.value)}hasEmptyCells(e){return e.filter(r=>!r._cellState.value)}toggleCellsOld(){this.state$$.update(e=>(e.forEach(r=>r.new=!1),[...e]))}startGame(){let e=this.ls.getState();this.state$$.set(this.ls.getState()),this.turn$$.set(this.ls.getTurn()),e.length||(this.generateKeys(),this.generateValues(2),this.turn$$.set(1))}restartGame(){this.ls.clear(),this.startGame()}static \u0275fac=function(r){return new(r||n)(h(q),h(b),h($))};static \u0275cmp=f({type:n,selectors:[["app-root"]],viewQuery:function(r,o){if(r&1&&z(C,5),r&2){let t;B(t=K())&&(o.cellList=t)}},hostBindings:function(r,o){r&1&&k("keydown",function(i){return o.move(i)},!1,O)},standalone:!0,features:[u],decls:10,vars:1,consts:[[1,"scoreboard"],[3,"click"],[3,"cellKey","cellValue","cellNew"]],template:function(r,o){r&1&&(s(0,"div",0)(1,"h1"),m(2),c(),s(3,"h1"),m(4,"Score: 6256"),c(),s(5,"button",1),k("click",function(){return o.restartGame()}),m(6,"New game"),c()(),s(7,"grid-container"),F(8,de,1,3,"grid-cell",2,W),c()),r&2&&(d(2),J("Turn: ",o.turn$$(),""),d(6),P(o.state$$()))},dependencies:[y,C],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;height:90svh;flex-direction:column}.scoreboard[_ngcontent-%COMP%]{display:flex;gap:1rem;color:gray;align-items:center}button[_ngcontent-%COMP%]{font-size:large;font-weight:600;color:gray;padding:5px;height:fit-content}button[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover{color:#97ba1e}"]})};var ae=[];var le={providers:[U({eventCoalescing:!0}),re(ae),ee()]};var ge={providers:[te()]},se=Z(le,ge);var Ce=()=>Y(G,se),_t=Ce;export{_t as a};
